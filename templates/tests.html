<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


    <script src="http://ajax.microsoft.com/ajax/jquery/jquery-3.2.1.min.js"></script>
    <title>stock</title>

    <script>
        function addstock() {
//            $.ajax({
//                url: "/test3",
//                type: 'POST',
//                contentType: 'text/plain',
//                data: {'panel_id':$('[name=xxxxx]').attr('key-data')},
//                beforeSend:function(){
//                    let stid = document.getElementById('xxxxx').value,
//                        stidtest = /\d{6}/
//                    if (!stidtest.test(stid))
//                    {alert('mdzz');
//                    return false}
//                }
//            });
            alert($(this).serialize())
//            var a = $('[name=xxxxx]').attr('key-data')
//            alert(a)
//            alert($('[name=xxxxx]').val())
        }

    </script>

</head>
<body>
    <script>
        $.ajax({
        url: "/getpanel",
        dataType: 'json',
        data: '',
        timeout: 10000,
        success:function(data){
                addul(data)}
        });
        function addul(data) {
            let ul = $('body')
            for (let i in data){
                        ul.append(`<div class="col-md-6">
                        <div class="panel panel-primary">
                            <div class="panel-heading">${data[i]['name']}</div>
                            <ul class='stocks' id=${data[i]['panel_id']}>
                                <li >
                                    <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 股票名 </span>
                                    <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 股票代码 </span>
                                    <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 当前价 </span>
                                    <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 涨跌幅 </span>
                                    <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 成交量(手数) </span>
                                    <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 换手率 </span>
                                </li>
                            </ul>
                            <form class="add_stock">
                                股票代码:<input type="text" name=${data[i]['panel_id']}>
                            <button type="submit" class="btn btn-sm btn-primary">添加股票</button>
                            </form>
                        </div>
                    </div>`)
            }

        }

    </script>








    <script>
    $(document).ready(function () {
        $.ajax({
            url: "/getstocklist",
            dataType: 'json',
            data: '',
            timeout: 10000,
            success: function (data) {
                addvalue(data)
            }
        });
        function addvalue(data) {
            let ul;
            for (let i in data){
                ul = $(`#${data[i]['panel_id']}`);
                for (let j in data[i]['list']){
                    ul.append(`<li name=${data[i]['list'][j]}>
                        <span class='stockname' style="text-align: center; width: 100px; display: inline-block;"></span>
                        <span class='stockid' style="text-align: center; width: 100px; display: inline-block;">${data[i]['list'][j]}</span>
                        <span class='stockprice' style="text-align: center; width: 100px; display: inline-block;"></span>
                        <span class='stockchange' style="text-align: center; width: 100px; display: inline-block;"></span>
                        <span class='stockvolum' style="text-align: center; width: 100px; display: inline-block;"></span>
                        <span class='stockrate' style="text-align: center; width: 100px; display: inline-block;"></span>
                        <span class='delete' data-key=${data[i]['list'][j]} style="text-align: center; width: 100px; display: inline-block;">删除</span>
                        </li>`);
                }

            }
        }
    })
    </script>

    <script>
        $(document).ready(function () {
//            setInterval(runajax1,5000)
//            function runajax1() {
                            $.ajax({
            url: "/getstockinform",
            dataType: 'json',
            data: '',
            timeout: 3000,

            success:function(data) {
                refreshPrice(data)
            }
        });
//            }


            function refreshPrice(data){
                let ul;
                for (let i in data){
                    for (let j in data[i]['list']){
                        ul = $(`#${data[i]['panel_id']} [name=${data[i]['list'][j]['b']}]`);

                        ul.find('.stockname').text(`${data[i]['list'][j]['a']}`);
                        ul.find('.stockid').text(`${data[i]['list'][j]['b']}`);
                        ul.find('.stockprice').text(`${data[i]['list'][j]['c']}`);
                        if (data[i]['list'][j]['d']<0) {
                            ul.find('.stockchange').text(`${data[i]['list'][j]['d']}%`)
                        }else{
                            ul.find('.stockchange').text(`${data[i]['list'][j]['d']}%`)
                        }
                        ul.find('.stockvolum').text(`${data[i]['list'][j]['e']}`);
                        ul.find('.stockrate').text(`${data[i]['list'][j]['f']}`);

                    }


                }


             }
        })
    </script>

</body>
</html>