<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script src="http://ajax.microsoft.com/ajax/jquery/jquery-3.2.1.min.js">
</script>

<script>
    function refreshPrice(data) {
        $('#test-jsonp').text('当前价格：' +
            data['0000001'].name + '：' +
            data['0000001'].price + '；' +
            data['1399001'].name + '：' +
            data['1399001'].price)
    }
</script>

<script>
    function refreshPrice1(data) {
        let ul;
        let a;
        for (let i in data){
            let add_colour
            a = data[i]['b'];
            ul = $(`#${a}`);
//            if (data[i]['d']<0) {
//                add_colour = `<span id='stockchange' style="text-align: center; width: 100px; display: inline-block; color: green">${data[i]['d']}%</span>`
//            }else{
//                add_colour = `<span id='stockchange' style="text-align: center; width: 100px; display: inline-block; color: red">${data[i]['d']}%</span>`
//            }
//            ul.html(`<li id=${a}><span id='stockname' style="text-align: center; width: 100px; display: inline-block;">${data[i]['a']}</span>
//                        <span id='stockid' style="text-align: center; width: 100px; display: inline-block;">${data[i]['b']}</span>
//                        <span id='stockprice' style="text-align: center; width: 100px; display: inline-block;">${data[i]['c']}</span>
//                        ${add_colour}
//                        <span id='stockvolum' style="text-align: center; width: 100px; display: inline-block;">${data[i]['e']}</span>
//                        <span id='stockrate' style="text-align: center; width: 100px; display: inline-block;">${data[i]['f']}</span>
//                        </li>`)
            ul.find('#stockname').html(`<span id='stockname' style="text-align: center; width: 100px; display: inline-block;">${data[i]['a']}</span>`);
            ul.find('#stockid').html(`<span id='stockid' style="text-align: center; width: 100px; display: inline-block;">${data[i]['b']}</span>`);
            ul.find('#stockprice').html(`<span id='stockprice' style="text-align: center; width: 100px; display: inline-block;">${data[i]['c']}</span>`);
            if (data[i]['d']<0) {
                ul.find('#stockchange').html(`<span id='stockchange' style="text-align: center; width: 100px; display: inline-block; color: green">${data[i]['d']}%</span>`)
            }else{
                ul.find('#stockchange').html(`<span id='stockchange' style="text-align: center; width: 100px; display: inline-block; color: red">${data[i]['d']}%</span>`)
            }
            ul.find('#stockvolum').html(`<span id='stockvolum' style="text-align: center; width: 100px; display: inline-block;">${data[i]['e']}</span>`);
            ul.find('#stockrate').html(`<span id='stockrate' style="text-align: center; width: 100px; display: inline-block;">${data[i]['f']}</span>`);
        }
    }
</script>




<script>
    setInterval(runajax1,1000);
//    getid();
    function runajax1() {
            $.ajax({
            url: "/test",
            dataType: 'json',
            data: '',
            timeout: 3000,

            success:function(data){
                refreshPrice1(data)
            }
        });
    }
</script>

<script>
function addstock() {
        $.ajax({
        url: "/test3",
        type: 'POST',
        contentType: 'text/plain',
        data: document.getElementById('xxxxx').value,
        beforeSend:function(){
            let stid = document.getElementById('xxxxx').value,
                stidtest = /\d{6}/
            if (!stidtest.test(stid))
            {alert('mdzz');
            return false}
        }
//        headers:{"Content-type": "text/plain"}
//
//        success:function(data){
//            refreshPrice1(data)
//        }
        });
}
</script>

<script>
    $.ajax({
        url: "/test1",
        dataType: 'json',
        data: '',
        timeout: 3000,
        success:function(data){
                adddata(data)}
    });
    function adddata(data) {
        let ul = $('.stocks');
    for (let i in data['a']) {
        ul.append(`<li id=${data['a'][i]}><span id='stockname' style="text-align: center; width: 100px; display: inline-block;"></span>
                    <span id='stockid' style="text-align: center; width: 100px; display: inline-block;">${data['a'][i]}</span>
                    <span id='stockprice' style="text-align: center; width: 100px; display: inline-block;"></span>
                    <span id='stockchange' style="text-align: center; width: 100px; display: inline-block;"></span>
                    <span id='stockvolum' style="text-align: center; width: 100px; display: inline-block;"></span>
                    <span id='stockrate' style="text-align: center; width: 100px; display: inline-block;"></span>
                    <span class='delete' data-key=${data['a'][i]} style="text-align: center; width: 100px; display: inline-block;">删除</span>
                    </li>`);}
    }


</script>


</head>
<body>
<div class="col-md-6">
    <div class="panel panel-primary">
    <div class="panel-heading">面板标题</div>
    <ul class='stocks'>
    <li id='title'>
        <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 股票名 </span>
        <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 股票代码 </span>
        <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 当前价 </span>
        <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 涨跌幅 </span>
        <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 成交量(手数) </span>
        <span class="badge" style="text-align: center; width: 100px; display: inline-block;"> 换手率 </span>
    </li>
</ul>
<form id="test-form" onsubmit="return addstock()">
    股票代码:<input type="text" id="xxxxx" name="xxxxx">
    <button type="submit" class="btn btn-sm btn-primary">Submit</button>
</form>
    </div>
</div>

<script>
        $('.stocks').on('click',"li .delete",function () {
        let $el = $(this);
        console.log($el);
        let key = $el.attr('data-key');
        console.log(key);
        $(`#${key}`).remove();
        $.ajax({
            url: "/test4",
            type: 'POST',
            contentType: 'text/plain',
            data: key,
            })
         });
</script>



<!--<img src="../static/timg.jpg">-->



</body>
</html>
